API1常规流程，setPreviewDisplay和startPreview配流后调用setFlashMode，需要开启预览后才能控制闪光灯

```cpp
diff --git a/services/camera/libcameraservice/CameraService.h b/services/camera/libcameraservice/CameraService.h
index 4321201..f962b95 100644
--- a/services/camera/libcameraservice/CameraService.h
+++ b/services/camera/libcameraservice/CameraService.h
@@ -483,6 +483,7 @@
 
     int32_t updateAudioRestriction();
     int32_t updateAudioRestrictionLocked();
+    sp<CameraProviderManager> getProviderManager() {return mCameraProviderManager;};
 
 private:
 
diff --git a/services/camera/libcameraservice/api1/Camera2Client.cpp b/services/camera/libcameraservice/api1/Camera2Client.cpp
index a2d5371..62ece31 100644
--- a/services/camera/libcameraservice/api1/Camera2Client.cpp
+++ b/services/camera/libcameraservice/api1/Camera2Client.cpp
@@ -50,6 +50,7 @@
 using namespace camera2;
 
 // Interface used by CameraService
+static sp<CameraService> mcameraService;
 
 Camera2Client::Camera2Client(const sp<CameraService>& cameraService,
         const sp<hardware::ICameraClient>& cameraClient,
@@ -67,6 +68,7 @@
         mParameters(api1CameraId, cameraFacing)
 {
     ATRACE_CALL();
+    mcameraService = cameraService;
 
     SharedParameters::Lock l(mParameters);
     l.mParameters.state = Parameters::DISCONNECTED;
@@ -1589,6 +1591,17 @@
     if ( (res = checkPid(__FUNCTION__) ) != OK) return res;
 
     SharedParameters::Lock l(mParameters);
+    Parameters::flashMode_t flashModeBefore = l.mParameters.flashMode;
+    CameraParameters2 newParams(params);
+    ALOGV("%s: flashMode Before %d", __FUNCTION__, flashModeBefore);
+    ALOGV("%s: flashMode new %d", __FUNCTION__,
+    l.mParameters.flashModeStringToEnum(newParams.get(CameraParameters::KEY_FLASH_MODE)));
+    if(flashModeBefore != l.mParameters.flashModeStringToEnum(newParams.get(CameraParameters::KEY_FLASH_MODE))
+        ) {
+        mcameraService->getProviderManager()->setTorchMode("0",
+            (Parameters::FLASH_MODE_TORCH ==
+            l.mParameters.flashModeStringToEnum(newParams.get(CameraParameters::KEY_FLASH_MODE))?1:0));
+    }
 
     Parameters::focusMode_t focusModeBefore = l.mParameters.focusMode;
     res = l.mParameters.set(params);

```

API2:

```
    private void turnOnFlash() {
        Log.d("hursion: ", "isFlashOn = "+isFlashOn);
                try {
            if (Build.VERSION.SDK_INT >= 23) {
                mCameraManager.setTorchMode("0", true);
            }
        } catch (CameraAccessException e) {
            Log.e("hursion", "Couldn't set torch mode", e);
        }
        isFlashOn = true;
        // changing button/switch image
        toggleButtonImage();
    }
```