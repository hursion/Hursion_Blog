

# 正则去搜索后无用字符

^     	Line \d{3-5}: [A-Za-z0-9]{7} 
去重
^(.*?)$\s+?^(?=.*^\1$) 

vim删除重复行的命令如下：

: sort u

# 不生成odex：

```makefile
 LOCAL_DEX_PREOPT := false
```



```bp
dex_preopt: {
    enabled: false,
},
```

 

  

# lmkd保护 

以下内容的前提，进程被lmk或lmkd杀掉了。

\1.   如果是 androidq以前的android版本使用的是lmk 只能通过修改代码来规避被lmk杀掉，或请owner 或 性能的同事评估是否能临时提高进程的优先级。

ex：

```c
--- a/drivers/staging/android/lowmemorykiller.c
+++ b/drivers/staging/android/lowmemorykiller.c
@@ -632,6 +632,12 @@ static unsigned long lowmem_scan(struct shrinker *s, struct shrink_control *sc)
                        continue;
                }

+               /*
+                * workaround for com.android.camera2
+                * */
+               if (strstr("com.android.camera2", p->comm))
+                       continue;
+
                /* workaround for antutu */
                if (strstr("com.antutu.benchmark.full", p->comm))
                        has_antutu_3D = true;
```

\2.   如果是 androidq(含) 以后的 android 版本 使用的是 lmkd 可以将进程加入白名单，或请owner 或 性能的同事评估是否能临时提高进程的优先级。 

白名单位置：

AndroidQ：sprdroid10_trunk_19c/device/sprd/项目/common/lmkd_param.conf

AndroidR：sprdroidr_trunk/device/sprd/mpool/module/memory/lmkd/msoc/项目/lmkd_param.conf

# git

git push ssh://hursion.zhang@review.source.unisoc.com:29418/vendor/sprd/platform/packages/apps/NewGallery2 HEAD:refs/for/sprdroidr_trunk_iebu_21a



# 开启状态栏时分秒

```shell
adb shell pm enable com.android.systemui/com.android.systemui.tuner.TunerActivity
adb shell am start -n com.android.systemui/com.android.systemui.tuner.TunerActivity
```

# addr2line使用

hursion.zhang@shand123:~/codedir/sprdroid10_trunk_19c_rls1/prebuilts/gcc/linux-x86/aarch64/aarch64-linux-android-4.9/bin$ ./aarch64-linux-android-addr2line -f -e system_lib/system_lib/libaudiopolicyservice.so 000000000001af84
_ZN7android18AudioPolicyService18AudioCommandThread13volumeCommandE19audio_stream_type_tfii
frameworks/av/services/audiopolicy/service/AudioPolicyService.cpp:1370

# objdump使用

hursion.zhang@shand123:~/codedir/sprdroid10_trunk_19c_rls1/prebuilts/gcc/linux-x86/aarch64/aarch64-linux-android-4.9/bin$ ./aarch64-linux-androidkernel-objdump -d ../aarch64-linux-android/bin/libprocessgroup.so >1.txt

```
尊敬的客户： 1、贵司的Android.bp写法没有问题。 2、从贵司图片报错log来看： out/soong/.intermediates/development/build/android_test_stubs_current/android_common/javac/srcjars/com/banyac/midrive/mcu/IMCUManager.java:23: error: cannot find symbol public com.banyac.midrive.mcu.state.StateInfo getStateInfo() throws android.os.RemoteException;                                   ^  symbol:   class StateInfo  location: package com.banyac.midrive.mcu.state 无法找到symbol:   class StateInfo。 修改如下： 1、自定义添加的aidl文件中增加@hide注释，使其和java文件一样使用内部接口。 备注：java/com为内部api，java/android中的api可以是内部，也可以是public api，之前报错应该是aidl文件和java文件api接口不一致。 2、在build/core/tasks/check_boot_jars/package_whitelist.txt中增加bootjar白名单，添加内容如下： com\.banyac\..* android_serialport_api 3、执行： make api-stubs-docs-update-current-api make 即可。 
```







10.0

```
合入下面修改,将logcat log输出到串口,需要抓取下 uart android log, 并重新抓取开机串口Log:
(1). 设置loglevel=7
需要在kernel/arch/arm/boot/dts/<sprd-xx-yourboard>.dts中
bootargs = ""里修改loglevel字段
-------------------------------------------------
loglevel=7, console=ttyS1,115200n8

(2).在init.xx.rc中靠前的位置增加如下启动项
-----------------------------------------------------------------
bj@and03:~/sprdroid8.1_trunk_18a_rls2/device/sprd/sharkl3/common$ git diff ./
diff --git a/common/rootdir/root/init.common.rc
b/common/rootdir/root/init.common.rc
index 95fec1e..2730e33 100755
--- a/common/rootdir/root/init.common.rc
+++ b/common/rootdir/root/init.common.rc
@@ -141,6 +141,12 @@ 
on post-fs-data
196         mkdir /data/vendor/thermald 0770 system system
197         chown system system /data/vendor/thermald
198         #mkdir /data/misc/hprofs 0777
199         #start aprd

+service logcat /system/bin/logcat -f /dev/kmsg *:w
+ class main
+ user root
+ group log
+ oneshot
+

201 service p2p_supplicant /vendor/bin/hw/wpa_supplicant \

(3).关闭selinux: 
/system/core/init/init.cpp
-----------------------------------------------------------------
static bool selinux_is_enforcing(void) 函数开头return false;
//需重新烧录 boot/system image.
```



mirco5打开副mic

```
请在贵司/device/sprd/sharkle/XXXX/rootdir/system/etc/audio_params/audio_policy.conf中做如下改动：
原来代码：
global_configuration {
  attached_output_devices AUDIO_DEVICE_OUT_EARPIECE|AUDIO_DEVICE_OUT_SPEAKER
  default_output_device AUDIO_DEVICE_OUT_SPEAKER
  attached_input_devices AUDIO_DEVICE_IN_BUILTIN_MIC|AUDIO_DEVICE_IN_REMOTE_SUBMIX|AUDIO_DEVICE_IN_FM_TUNER
}
在最后增加上AUDIO_DEVICE_IN_BACK_MIC：
global_configuration {
  attached_output_devices AUDIO_DEVICE_OUT_EARPIECE|AUDIO_DEVICE_OUT_SPEAKER
  default_output_device AUDIO_DEVICE_OUT_SPEAKER
  attached_input_devices AUDIO_DEVICE_IN_BUILTIN_MIC|AUDIO_DEVICE_IN_REMOTE_SUBMIX|AUDIO_DEVICE_IN_FM_TUNER|AUDIO_DEVICE_IN_BACK_MIC
}

录制的时候使用CAMCORDER这个source，看是否有效
```



inputbuffer

http://10.0.1.79:8081/xref/sprdroidr_trunk/vendor/sprd/modules/media/v2/omx-components/video/avc/dec/hw/SPRDAVCDecoder.h#84





wifidisplay:



http://10.0.1.79:8081/source/xref/sprdroid10_trunk_19c_rls1/frameworks/av/media/libstagefright/wifi-display/VideoFormats.cpp

http://10.0.1.79:8081/source/xref/sprdroid10_trunk_19c_rls1/frameworks/av/media/libstagefright/wifi-display/source/WifiDisplaySource.cpp#84



adb root
 adb remount
 adb shell setenforce 0
 adb shell
 cd data
 mkdir dump
 setprop debug.hwc.dumppath /data/dump/
 setprop debug.hwc.dumpflag 1
 复现问题
 setprop debug.hwc.dumpflag 0





自定义TAG：

ØJava framework层

import [Android](http://codecloud.net/tag/Android).os.Trace; 
 Trace.traceBegin(long traceTag, String methodName)
 Trace.traceEnd(long traceTag) 



ØApp层

import [Android](http://codecloud.net/tag/Android).os.Trace;
 Trace.beginSection(String sectionName)
 Trace.EndSection() 





ØNative 层

\#include<utils/Trace.h>

ATRACE_BEGIN("TEST");

ATRACE_END();



  

注意：添加的时候begin与end需要在同一线程中执行。其实一般只要在同一个函数中成对添加即可。



chrome-everything-kgpm plugin



### 设备路由选择

8.1修改

[frameworks](http://opengrok03.unisoc.com:8082/xref/sprdroid8.1_orca_20a/frameworks/)/[av](http://opengrok03.unisoc.com:8082/xref/sprdroid8.1_orca_20a/frameworks/av/)/[services](http://opengrok03.unisoc.com:8082/xref/sprdroid8.1_orca_20a/frameworks/av/services/)/[audiopolicy](http://opengrok03.unisoc.com:8082/xref/sprdroid8.1_orca_20a/frameworks/av/services/audiopolicy/)/[enginedefault](http://opengrok03.unisoc.com:8082/xref/sprdroid8.1_orca_20a/frameworks/av/services/audiopolicy/enginedefault/)/[src](http://opengrok03.unisoc.com:8082/xref/sprdroid8.1_orca_20a/frameworks/av/services/audiopolicy/enginedefault/src/)/[Engine.cpp](http://opengrok03.unisoc.com:8082/xref/sprdroid8.1_orca_20a/frameworks/av/services/audiopolicy/enginedefault/src/Engine.cpp) 

10.0及以上

[device](https://opengrok01.unisoc.com/xref/sprdroid10_trunk_19c_rls1/device/)/[sprd](https://opengrok01.unisoc.com/xref/sprdroid10_trunk_19c_rls1/device/sprd/)/[sharkl3](https://opengrok01.unisoc.com/xref/sprdroid10_trunk_19c_rls1/device/sprd/sharkl3/)/[s9863a10c10](https://opengrok01.unisoc.com/xref/sprdroid10_trunk_19c_rls1/device/sprd/sharkl3/s9863a10c10/)/[rootdir](https://opengrok01.unisoc.com/xref/sprdroid10_trunk_19c_rls1/device/sprd/sharkl3/s9863a10c10/rootdir/)/[system](https://opengrok01.unisoc.com/xref/sprdroid10_trunk_19c_rls1/device/sprd/sharkl3/s9863a10c10/rootdir/system/)/[etc](https://opengrok01.unisoc.com/xref/sprdroid10_trunk_19c_rls1/device/sprd/sharkl3/s9863a10c10/rootdir/system/etc/)/[parameter-framework](https://opengrok01.unisoc.com/xref/sprdroid10_trunk_19c_rls1/device/sprd/sharkl3/s9863a10c10/rootdir/system/etc/parameter-framework/)/[Settings](https://opengrok01.unisoc.com/xref/sprdroid10_trunk_19c_rls1/device/sprd/sharkl3/s9863a10c10/rootdir/system/etc/parameter-framework/Settings/)/



